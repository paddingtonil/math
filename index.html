<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×¨×’×•×œ ×œ××‘×—×Ÿ ××ª××˜×™×§×” - ×›×™×ª×” ×“×³</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .math-expression {
            direction: ltr;
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: #1e40af;
            margin: 1rem 0;
            padding: 1rem;
            background-color: #eff6ff;
            border-radius: 0.5rem;
            border: 2px solid #3b82f6;
        }
        .level-badge {
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .streak-indicator {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const MathPracticeGame = () => {
          const [currentQuestion, setCurrentQuestion] = useState(null);
          const [previousQuestionIndex, setPreviousQuestionIndex] = useState(null);
          const [userAnswer, setUserAnswer] = useState('');
          const [feedback, setFeedback] = useState(null);
          const [score, setScore] = useState({ correct: 0, total: 0 });
          const [showExplanation, setShowExplanation] = useState(false);
          const [currentLevel, setCurrentLevel] = useState('regular'); // regular, advanced, challenge
          const [streak, setStreak] = useState(0);
          const [showLevelUp, setShowLevelUp] = useState(false);

          const parseQuestion = (question) => {
            const patterns = [
              /(.+?):\s*(.+)$/,
              /(.+?)\s+([\d\/â…“â…”Â¼Â¾â…›â…œâ…â…]+\s*[+\-Ã—Ã·]\s*.+)$/,
            ];
            
            for (let pattern of patterns) {
              const match = question.match(pattern);
              if (match) {
                return {
                  instruction: match[1].trim(),
                  expression: match[2].trim()
                };
              }
            }
            
            return {
              instruction: question,
              expression: null
            };
          };

          const getLevelText = (level) => {
            switch(level) {
              case 'regular': return '×¨××”: ×¨×’×™×œ×” â­';
              case 'advanced': return '×¨××”: ××ª×§×“××ª â­â­';
              case 'challenge': return '×¨××”: ××ª×’×¨ â­â­â­';
              default: return '';
            }
          };

          const getLevelColor = (level) => {
            switch(level) {
              case 'regular': return 'bg-blue-500 text-white';
              case 'advanced': return 'bg-purple-500 text-white';
              case 'challenge': return 'bg-red-500 text-white';
              default: return 'bg-gray-500';
            }
          };

          // ×‘× ×§ ×©××œ×•×ª ××•×¨×—×‘ - ×¨××” ×¨×’×™×œ×” ×›×•×œ×œ×ª ××ª ×›×œ ×—×•××¨ ×”××‘×—×Ÿ
          const questionBank = [
            // ×¨××” ×¨×’×™×œ×” - ×—×•××¨ ×”××‘×—×Ÿ ×”×‘×¡×™×¡×™
            {
              question: '×§×¨×/×™ ×•×›×ª×•×‘/×™ ××ª ×”×©×‘×¨: ×©× ×™ ×©×œ×™×©×™×',
              answer: '2/3',
              alternatives: ['â…”'],
              explanation: '×©× ×™ ×©×œ×™×©×™× = 2 ×—×œ×§×™× ××ª×•×š 3 = 2/3 ××• â…”',
              difficulty: 'regular'
            },
            {
              question: '×›××” ×¨×‘×¢×™× ×™×© ×‘×©×œ× ××—×“?',
              answer: '4',
              explanation: '×©×œ× ××—×“ = 4/4 = 4 ×¨×‘×¢×™×',
              difficulty: 'regular',
              commonMistake: '×œ× ×œ×‘×œ×‘×œ ×¢× "×›××” ×©×œ××™× ×™×© ×‘-4 ×¨×‘×¢×™×"'
            },
            {
              question: '×›××” ×©××™× ×™×•×ª ×™×© ×‘×©×œ× ××—×“?',
              answer: '8',
              explanation: '×©×œ× ××—×“ = 8/8 = 8 ×©××™× ×™×•×ª',
              difficulty: 'regular'
            },
            {
              question: '×”×× ×”×©×‘×¨ 8/8 ×©×•×•×” ×œ×©×œ×? (×›×Ÿ/×œ×)',
              answer: '×›×Ÿ',
              alternatives: ['yes', '×›'],
              explanation: '8/8 = ×©×œ× ××—×“! ×›×©×”××•× ×” ×•×”××›× ×” ×©×•×•×™×, ×–×” ×©×œ×',
              difficulty: 'regular'
            },
            {
              question: '×”××¨/×™ ×œ××¡×¤×¨ ××¢×•×¨×‘: 7/4',
              answer: '1Â¾',
              alternatives: ['1 3/4'],
              explanation: '7Ã·4 = 1 ×©×œ× ×•× ×©××¨ 3, ×œ×›×Ÿ 7/4 = 1Â¾',
              difficulty: 'regular',
              commonMistake: '×œ×—×œ×§: 7Ã·4 = 1 ×©×œ×, ×•-3 ×©× ×©××¨ ×”×•× ×”××•× ×” ×”×—×“×©'
            },
            {
              question: '×”××¨/×™ ×œ×©×‘×¨ ×¤×©×•×˜: 2â…“',
              answer: '7/3',
              explanation: '2 Ã— 3 = 6, ×•×¢×•×“ 1 = 7, ×œ×›×Ÿ 2â…“ = 7/3',
              difficulty: 'regular',
              commonMistake: '×œ×›×¤×•×œ ××ª ×”××›× ×” ×‘×©×œ××™× ×•××– ×œ×—×‘×¨ ××ª ×”××•× ×”!'
            },
            {
              question: '×¦××¦×/×™: 4/8',
              answer: '1/2',
              alternatives: ['Â½'],
              explanation: '4Ã·4 = 1, 8Ã·4 = 2, ×œ×›×Ÿ 4/8 = 1/2',
              difficulty: 'regular',
              commonMistake: '×œ×—×¤×© ××ª ×”××—×œ×§ ×”××©×•×ª×£ ×”×’×“×•×œ ×‘×™×•×ª×¨'
            },
            {
              question: '××¦×/×™ ×©× × ×•×¡×£ ×œ×©×‘×¨ Â½ (×¢× ××›× ×” 10):',
              answer: '5/10',
              explanation: 'Â½ = 5/10 (×›×¤×œ× ×• ×’× ××ª ×”××•× ×” ×•×’× ××ª ×”××›× ×” ×‘-5)',
              difficulty: 'regular'
            },
            {
              question: '×¦××¦×/×™: 6/9',
              answer: '2/3',
              alternatives: ['â…”'],
              explanation: '6Ã·3 = 2, 9Ã·3 = 3, ×œ×›×Ÿ 6/9 = 2/3',
              difficulty: 'regular'
            },
            {
              question: '×¡××Ÿ/×™ < , > ××• =:    Â½ ___ Â¼',
              answer: '>',
              explanation: '×—×¦×™ ×’×“×•×œ ×™×•×ª×¨ ××¨×‘×¢! ×›×›×œ ×©×”××›× ×” ×’×“×•×œ ×™×•×ª×¨, ×”×—×œ×§ ×§×˜×Ÿ ×™×•×ª×¨',
              difficulty: 'regular',
              commonMistake: '×›×©×”××•× ×” ×–×”×”, ×”××›× ×” ×”×§×˜×Ÿ = ×”×©×‘×¨ ×”×’×“×•×œ!'
            },
            {
              question: '×¡××Ÿ/×™ < , > ××• =:    â…” ___ 4/6',
              answer: '=',
              explanation: 'â…” = 4/6 (×× × ×¦××¦× 4/6 × ×§×‘×œ â…”)',
              difficulty: 'regular'
            },
            {
              question: '×¡××Ÿ/×™ < , > ××• =:    â…“ ___ Â½',
              answer: '<',
              explanation: '×©×œ×™×© ×§×˜×Ÿ ××—×¦×™! â…“ < Â½',
              difficulty: 'regular'
            },
            {
              question: '×›×ª×•×‘/×™ ×‘××™×œ×™×: 35,428',
              answer: '×©×œ×•×©×™× ×•×—××™×©×” ××œ×£ ××¨×‘×¢ ×××•×ª ×¢×©×¨×™× ×•×©××•× ×”',
              explanation: '35,000 + 400 + 20 + 8',
              difficulty: 'regular'
            },
            {
              question: '×›×ª×•×‘/×™ ×‘×¡×¤×¨×•×ª: ×¢×©×¨×™× ×•×©×œ×•×©×” ××œ×£ ×•×××ª×™×™×',
              answer: '23200',
              alternatives: ['23,200'],
              explanation: '20,000 + 3,000 + 200 = 23,200',
              difficulty: 'regular'
            },
            {
              question: '×›×ª×•×‘/×™ ×‘×¡×¤×¨×•×ª: ×©×œ×•×©×™× ××œ×£ ×•×—××© ×××•×ª',
              answer: '30500',
              alternatives: ['30,500'],
              explanation: '30,000 + 500 = 30,500',
              difficulty: 'regular'
            },
            {
              question: '××” ×”××¡×¤×¨ ×”×¢×•×§×‘ ×œ××¡×¤×¨: 12,999',
              answer: '13000',
              alternatives: ['13,000'],
              explanation: '××—×¨×™ 12,999 ××’×™×¢ 13,000',
              difficulty: 'regular',
              commonMistake: '×œ×©×™× ×œ×‘ ×œ××¢×‘×¨ ×‘×™×Ÿ ××œ×¤×™×!'
            },
            {
              question: '××” ×”××¡×¤×¨ ×”×§×•×“× ×œ××¡×¤×¨: 20,000',
              answer: '19999',
              alternatives: ['19,999'],
              explanation: '×œ×¤× ×™ 20,000 ××’×™×¢ 19,999',
              difficulty: 'regular',
              commonMistake: '×œ×©×™× ×œ×‘ ×œ×©×™× ×•×™ ×‘×¡×¤×¨×•×ª!'
            },
            {
              question: '××” ×”××¡×¤×¨ ×”×¢×•×§×‘ ×œ××¡×¤×¨: 15,099',
              answer: '15100',
              alternatives: ['15,100'],
              explanation: '××—×¨×™ 15,099 ××’×™×¢ 15,100',
              difficulty: 'regular'
            },
            {
              question: '×—×©×‘/×™ ×œ×¤×™ ×¡×“×¨ ×¤×¢×•×œ×•×ª ×—×©×‘×•×Ÿ: 20 + 5 Ã— 4',
              answer: '40',
              explanation: '×¨××©×™×ª ×›×¤×œ: 5 Ã— 4 = 20, ×•××– ×—×™×‘×•×¨: 20 + 20 = 40',
              difficulty: 'regular',
              commonMistake: '×ª××™×“ ×›×¤×œ ×•×—×™×œ×•×§ ×œ×¤× ×™ ×—×™×‘×•×¨ ×•×—×™×¡×•×¨!'
            },
            {
              question: '×—×©×‘/×™ ×œ×¤×™ ×¡×“×¨ ×¤×¢×•×œ×•×ª ×—×©×‘×•×Ÿ: (30 - 10) Ã· 4',
              answer: '5',
              explanation: '×¨××©×™×ª ×¡×•×’×¨×™×™×: 30 - 10 = 20, ×•××– ×—×™×œ×•×§: 20 Ã· 4 = 5',
              difficulty: 'regular',
              commonMistake: '×¡×•×’×¨×™×™× ×ª××™×“ ×§×•×“×!'
            },
            {
              question: '×—×©×‘/×™: 15 - 3 Ã— 4',
              answer: '3',
              explanation: '×¨××©×™×ª ×›×¤×œ: 3 Ã— 4 = 12, ×•××– ×—×™×¡×•×¨: 15 - 12 = 3',
              difficulty: 'regular',
              commonMistake: '×›×¤×œ ×§×•×“× ×œ×—×™×¡×•×¨!'
            },
            {
              question: '×—×‘×¨/×™: 12,345 + 3,421',
              answer: '15766',
              alternatives: ['15,766'],
              explanation: '×—×™×‘×•×¨ ×¢××•×“×•×ª: 5+1=6, 4+2=6, 3+4=7, 2+3=5, 1+0=1',
              difficulty: 'regular'
            },
            {
              question: '×—×‘×¨/×™: 8,234 + 1,532',
              answer: '9766',
              alternatives: ['9,766'],
              explanation: '×—×™×‘×•×¨ ×¢××•×“×•×ª = 9,766',
              difficulty: 'regular'
            },
            {
              question: '×—×¡×¨/×™: 25,678 - 12,345',
              answer: '13333',
              alternatives: ['13,333'],
              explanation: '×—×™×¡×•×¨ ×¢××•×“×•×ª: ×”×¤×¨×© = 13,333',
              difficulty: 'regular'
            },
            {
              question: '×—×¡×¨/×™: 18,500 - 6,200',
              answer: '12300',
              alternatives: ['12,300'],
              explanation: '×—×™×¡×•×¨ ×¢××•×“×•×ª = 12,300',
              difficulty: 'regular'
            },
            {
              question: '×—×©×‘/×™: 8,000 + 2,500 - 1,200',
              answer: '9300',
              alternatives: ['9,300'],
              explanation: '8,000 + 2,500 = 10,500, ×•××– 10,500 - 1,200 = 9,300',
              difficulty: 'regular'
            },

            // ×¨××” ××ª×§×“××ª
            {
              question: '×›×ª×•×‘/×™ ×©×œ×•×©×” ×©××•×ª ×©×•× ×™× ×œ×©×‘×¨ Â½:',
              answer: '2/4',
              alternatives: ['3/6', '4/8', '5/10'],
              explanation: '×“×•×’×××•×ª: 2/4, 3/6, 4/8, 5/10... (×›×œ ××—×“ × ×›×•×Ÿ!)',
              difficulty: 'advanced'
            },
            {
              question: '×”××¨/×™ ×œ××¡×¤×¨ ××¢×•×¨×‘: 15/4',
              answer: '3Â¾',
              alternatives: ['3 3/4'],
              explanation: '15Ã·4 = 3 ×©×œ××™× ×•× ×©××¨ 3, ×œ×›×Ÿ 15/4 = 3Â¾',
              difficulty: 'advanced'
            },
            {
              question: '×”××¨/×™ ×œ×©×‘×¨ ×¤×©×•×˜: 5â…”',
              answer: '17/3',
              explanation: '5 Ã— 3 = 15, ×•×¢×•×“ 2 = 17, ×œ×›×Ÿ 5â…” = 17/3',
              difficulty: 'advanced',
              commonMistake: '×œ×›×¤×•×œ ×”××›× ×” ×‘×©×œ××™× ×•××– ×œ×—×‘×¨ ×”××•× ×”'
            },
            {
              question: '×¦××¦×/×™ ×¢×“ ×”×¡×•×£: 12/18',
              answer: '2/3',
              alternatives: ['â…”'],
              explanation: '12Ã·6 = 2, 18Ã·6 = 3, ×œ×›×Ÿ 12/18 = 2/3',
              difficulty: 'advanced',
              commonMistake: '×œ××¦×•× ××ª ×”××—×œ×§ ×”××©×•×ª×£ ×”×’×“×•×œ ×‘×™×•×ª×¨ (6)'
            },
            {
              question: '×¦××¦×/×™ ×¢×“ ×”×¡×•×£: 15/20',
              answer: '3/4',
              alternatives: ['Â¾'],
              explanation: '15Ã·5 = 3, 20Ã·5 = 4, ×œ×›×Ÿ 15/20 = 3/4',
              difficulty: 'advanced'
            },
            {
              question: '×›××” ×©××™× ×™×•×ª ×™×© ×‘-2 ×©×œ××™×?',
              answer: '16',
              explanation: '2 Ã— 8 = 16 ×©××™× ×™×•×ª (2 = 16/8)',
              difficulty: 'advanced'
            },
            {
              question: '×¦××¦×/×™ ×•×”×©×•×•×”/×™: 6/9 ___ 4/6',
              answer: '=',
              explanation: '6/9 = 2/3 ×•-4/6 = 2/3, ×œ×›×Ÿ ×©×•×•×™×!',
              difficulty: 'advanced'
            },
            {
              question: '×¤×¨×§/×™ ×œ××¡×¤×¨×™×: 47,539 = ? ×¢×©×¨×•×ª ××œ×¤×™× + ? ××œ×¤×™×',
              answer: '4',
              alternatives: ['40000', '4+7'],
              explanation: '4 ×¢×©×¨×•×ª ××œ×¤×™× = 40,000, ×•-7 ××œ×¤×™× = 7,000',
              difficulty: 'advanced'
            },
            {
              question: '××” ×¢×¨×š ×”×¡×¤×¨×” 6 ×‘××¡×¤×¨: 63,215',
              answer: '60000',
              alternatives: ['60,000', '×©×©×™× ××œ×£'],
              explanation: '×”×¡×¤×¨×” 6 ×‘××§×•× ×¢×©×¨×•×ª ×”××œ×¤×™× = 60,000',
              difficulty: 'advanced'
            },
            {
              question: '××™×–×” ××¡×¤×¨ × ××¦× ×‘×“×™×•×§ ×‘×××¦×¢ ×‘×™×Ÿ 18,200 ×œ-18,400?',
              answer: '18300',
              alternatives: ['18,300'],
              explanation: '18,200 + 100 = 18,300 (××• 18,400 - 100)',
              difficulty: 'advanced'
            },
            {
              question: '×—×©×‘/×™ ×œ×¤×™ ×¡×“×¨ ×¤×¢×•×œ×•×ª: 60 - 3 Ã— 8 + 12',
              answer: '48',
              explanation: '3 Ã— 8 = 24, ××– 60 - 24 = 36, ×•××– 36 + 12 = 48',
              difficulty: 'advanced',
              commonMistake: '×œ×–×›×•×¨: ×›×¤×œ ×§×•×“×!'
            },
            {
              question: '×—×©×‘/×™ ×œ×¤×™ ×¡×“×¨ ×¤×¢×•×œ×•×ª: 100 Ã· (5 + 5) Ã— 2',
              answer: '20',
              explanation: '×¡×•×’×¨×™×™×: 5 + 5 = 10, ××– 100 Ã· 10 = 10, ×•××– 10 Ã— 2 = 20',
              difficulty: 'advanced'
            },
            {
              question: '×—×‘×¨/×™: 38,456 + 15,789',
              answer: '54245',
              alternatives: ['54,245'],
              explanation: '×—×™×‘×•×¨ ×¢××•×“×•×ª = 54,245',
              difficulty: 'advanced'
            },
            {
              question: '×—×¡×¨/×™: 50,000 - 23,567',
              answer: '26433',
              alternatives: ['26,433'],
              explanation: '×—×™×¡×•×¨ ×¢××•×“×•×ª ×¢× ×©××™×œ×•×ª = 26,433',
              difficulty: 'advanced',
              commonMistake: '×œ×©×™× ×œ×‘ ×œ×©××™×œ×•×ª!'
            },
            {
              question: '××¦×/×™ ××ª ×”××¡×¤×¨ ×”×—×¡×¨: 15,400 + ? = 20,000',
              answer: '4600',
              alternatives: ['4,600'],
              explanation: '20,000 - 15,400 = 4,600',
              difficulty: 'advanced'
            },

            // ×¨××” ××ª×’×¨
            {
              question: '×¦××¦×/×™ ××ª ×”×©×‘×¨ 24/36 ×¢×“ ×”×¡×•×£:',
              answer: '2/3',
              alternatives: ['â…”'],
              explanation: '24Ã·12 = 2, 36Ã·12 = 3, ×œ×›×Ÿ 24/36 = 2/3',
              difficulty: 'challenge',
              commonMistake: '×œ××¦×•× ××ª ×”××—×œ×§ ×”××©×•×ª×£ ×”×’×“×•×œ ×‘×™×•×ª×¨ (12)'
            },
            {
              question: '×”××¨/×™ 4â… ×œ×©×‘×¨ ×¤×©×•×˜:',
              answer: '37/8',
              explanation: '4 Ã— 8 = 32, 32 + 5 = 37, ×œ×›×Ÿ 4â… = 37/8',
              difficulty: 'challenge'
            },
            {
              question: '×¡××Ÿ/×™ < , > ××• =:    3/5 ___ 2/3',
              answer: '<',
              explanation: '3/5 = 9/15 ×•-2/3 = 10/15, ×œ×›×Ÿ 3/5 < 2/3',
              difficulty: 'challenge',
              commonMistake: '×œ×”×‘×™× ×œ××›× ×” ××©×•×ª×£!'
            },
            {
              question: '×¡××Ÿ/×™ < , > ××• =:    5/7 ___ Â¾',
              answer: '<',
              explanation: '5/7 = 20/28 ×•-Â¾ = 21/28, ×œ×›×Ÿ 5/7 < Â¾',
              difficulty: 'challenge'
            },
            {
              question: '×›×ª×•×‘/×™ ××ª ×”××¡×¤×¨ ×”×’×“×•×œ ×‘×™×•×ª×¨ ×¢× ×”×¡×¤×¨×•×ª: 3, 7, 0, 9, 2',
              answer: '97320',
              alternatives: ['97,320'],
              explanation: '× ×¡×“×¨ ××”×’×“×•×œ ×œ×§×˜×Ÿ: 9, 7, 3, 2, 0 = 97,320',
              difficulty: 'challenge'
            },
            {
              question: '××” ×”×”×¤×¨×© ×‘×™×Ÿ ×”××¡×¤×¨ ×”×’×“×•×œ ×‘×™×•×ª×¨ ×œ××¡×¤×¨ ×”×§×˜×Ÿ ×‘×™×•×ª×¨ ×©× ×™×ª×Ÿ ×œ×›×ª×•×‘ ×¢× 4, 8, 5, 1?',
              answer: '7083',
              alternatives: ['7,083'],
              explanation: '×”×’×“×•×œ: 8,541, ×”×§×˜×Ÿ: 1,458, ×”×¤×¨×©: 8,541 - 1,458 = 7,083',
              difficulty: 'challenge'
            },
            {
              question: '×—×©×‘/×™ ×œ×¤×™ ×¡×“×¨ ×¤×¢×•×œ×•×ª: 120 Ã· (8 - 2) + 15 Ã— 3',
              answer: '65',
              explanation: '(8-2)=6, 120Ã·6=20, 15Ã—3=45, 20+45=65',
              difficulty: 'challenge'
            },
            {
              question: '×”×©×œ×/×™ ××ª ×”××©×•×•××”: (? + 12) Ã— 5 = 100',
              answer: '8',
              explanation: '100 Ã· 5 = 20, ××– 20 - 12 = 8',
              difficulty: 'challenge'
            },
            {
              question: '×—×‘×¨/×™: 45,678 + 23,456 + 12,987',
              answer: '82121',
              alternatives: ['82,121'],
              explanation: '×—×™×‘×•×¨ ×©×œ 3 ××¡×¤×¨×™× = 82,121',
              difficulty: 'challenge'
            },
            {
              question: '×—×¡×¨/×™: 80,000 - 37,895',
              answer: '42105',
              alternatives: ['42,105'],
              explanation: '×—×™×¡×•×¨ ×¢× ×©××™×œ×•×ª ×¨×‘×•×ª = 42,105',
              difficulty: 'challenge',
              commonMistake: '×œ×©×™× ×œ×‘ ×œ×›×œ ×”×©××™×œ×•×ª!'
            }
          ];

          const generateNewQuestion = () => {
            const levelQuestions = questionBank.filter(q => q.difficulty === currentLevel);
            let randomIndex;
            
            do {
              randomIndex = Math.floor(Math.random() * levelQuestions.length);
            } while (levelQuestions.length > 1 && previousQuestionIndex === randomIndex);
            
            setCurrentQuestion(levelQuestions[randomIndex]);
            setPreviousQuestionIndex(randomIndex);
            setUserAnswer('');
            setFeedback(null);
            setShowExplanation(false);
          };

          useEffect(() => {
            generateNewQuestion();
          }, [currentLevel]);

          const checkLevelUp = (newStreak) => {
            if (newStreak >= 5) {
              if (currentLevel === 'regular') {
                setCurrentLevel('advanced');
                setShowLevelUp(true);
                setStreak(0);
                setTimeout(() => setShowLevelUp(false), 3000);
              } else if (currentLevel === 'advanced') {
                setCurrentLevel('challenge');
                setShowLevelUp(true);
                setStreak(0);
                setTimeout(() => setShowLevelUp(false), 3000);
              } else {
                setStreak(0);
              }
            }
          };

          const checkAnswer = () => {
            if (!userAnswer.trim()) {
              setFeedback({ correct: false, message: '× × ×œ×”×–×™×Ÿ ×ª×©×•×‘×”' });
              return;
            }

            const normalizedUserAnswer = userAnswer.trim().toLowerCase().replace(/\s+/g, '');
            const normalizedCorrectAnswer = currentQuestion.answer.toLowerCase().replace(/\s+/g, '');
            
            const alternatives = currentQuestion.alternatives || [];
            const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer ||
                             alternatives.some(alt => normalizedUserAnswer === alt.toLowerCase().replace(/\s+/g, ''));

            if (isCorrect) {
              setFeedback({ correct: true, message: 'âœ“ × ×›×•×Ÿ! ×›×œ ×”×›×‘×•×“!' });
              setScore(prev => ({ correct: prev.correct + 1, total: prev.total + 1 }));
              const newStreak = streak + 1;
              setStreak(newStreak);
              checkLevelUp(newStreak);
            } else {
              setFeedback({ 
                correct: false, 
                message: `âœ— ×œ× × ×›×•×Ÿ. ×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${currentQuestion.answer}` 
              });
              setScore(prev => ({ ...prev, total: prev.total + 1 }));
              setStreak(0);
              setShowExplanation(true);
            }
          };

          const handleKeyPress = (e) => {
            if (e.key === 'Enter') {
              if (feedback) {
                generateNewQuestion();
              } else {
                checkAnswer();
              }
            }
          };

          const getDifficultyColor = (difficulty) => {
            switch(difficulty) {
              case 'regular': return 'bg-blue-100 text-blue-800';
              case 'advanced': return 'bg-purple-100 text-purple-800';
              case 'challenge': return 'bg-red-100 text-red-800';
              default: return 'bg-gray-100';
            }
          };

          const getDifficultyText = (difficulty) => {
            switch(difficulty) {
              case 'regular': return '×¨×’×™×œ×”';
              case 'advanced': return '××ª×§×“××ª';
              case 'challenge': return '××ª×’×¨';
              default: return '';
            }
          };

          if (!currentQuestion) return <div className="p-8 text-center">×˜×•×¢×Ÿ...</div>;

          const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
          const parsedQuestion = parseQuestion(currentQuestion.question);

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6" dir="rtl">
              <div className="max-w-3xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h1 className="text-3xl font-bold text-center text-blue-600 mb-2">
                    ğŸ¯ ×ª×¨×’×•×œ ×œ××‘×—×Ÿ ××ª××˜×™×§×”
                  </h1>
                  <p className="text-center text-gray-600">×›×™×ª×” ×“' | ××‘×—×Ÿ ×ª××¨×™×š 17/11/2025</p>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                  <div className="flex justify-between items-center">
                    <div className={`px-4 py-2 rounded-lg font-bold level-badge ${getLevelColor(currentLevel)}`}>
                      {getLevelText(currentLevel)}
                    </div>
                    <div className="streak-indicator">
                      <span className="text-lg font-bold text-orange-600">ğŸ”¥ ×¨×¦×£: {streak}/5</span>
                      {streak > 0 && <span className="text-sm text-gray-600 mr-2">(×¢×•×“ {5 - streak} ×œ×¨××” ×”×‘××”!)</span>}
                    </div>
                  </div>
                </div>

                {showLevelUp && (
                  <div className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-lg shadow-lg p-6 mb-6 text-center animate-pulse">
                    <h2 className="text-2xl font-bold mb-2">ğŸ‰ ×›×œ ×”×›×‘×•×“!</h2>
                    <p className="text-xl">×¢×œ×™×ª ×œ×¨××” ×”×‘××”! {getLevelText(currentLevel)}</p>
                  </div>
                )}

                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="grid grid-cols-3 gap-4 text-center">
                    <div>
                      <div className="text-3xl font-bold text-green-600" dir="ltr">{score.correct}</div>
                      <div className="text-sm text-gray-600">×ª×©×•×‘×•×ª × ×›×•× ×•×ª</div>
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-blue-600" dir="ltr">{score.total}</div>
                      <div className="text-sm text-gray-600">×¡×”"×› ×©××œ×•×ª</div>
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-purple-600" dir="ltr">{percentage}%</div>
                      <div className="text-sm text-gray-600">××—×•×– ×”×¦×œ×—×”</div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                  <div className="flex justify-between items-center mb-4">
                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getDifficultyColor(currentQuestion.difficulty)}`}>
                      {getDifficultyText(currentQuestion.difficulty)}
                    </span>
                    <span className="text-sm text-gray-500">×©××œ×” #{score.total + 1}</span>
                  </div>

                  <div className="mb-6">
                    <p className="text-xl font-semibold text-gray-700 mb-3">
                      {parsedQuestion.instruction}
                    </p>
                    {parsedQuestion.expression && (
                      <div className="math-expression">
                        {parsedQuestion.expression}
                      </div>
                    )}
                  </div>

                  <div className="mb-4">
                    <input
                      type="text"
                      value={userAnswer}
                      onChange={(e) => setUserAnswer(e.target.value)}
                      onKeyPress={handleKeyPress}
                      placeholder="×”×§×œ×“/×™ ××ª ×”×ª×©×•×‘×” ×›××Ÿ..."
                      disabled={feedback !== null}
                      className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                      dir="ltr"
                      style={{textAlign: 'center', fontSize: '1.5rem'}}
                    />
                  </div>

                  {feedback && (
                    <div className={`p-4 rounded-lg mb-4 ${feedback.correct ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'}`}>
                      <p className={`font-bold text-lg ${feedback.correct ? 'text-green-800' : 'text-red-800'}`}>
                        {feedback.message}
                      </p>
                    </div>
                  )}

                  {showExplanation && currentQuestion.explanation && (
                    <div className="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-4">
                      <p className="font-bold text-blue-800 mb-2">ğŸ’¡ ×”×¡×‘×¨:</p>
                      <p className="text-blue-900" dir="ltr" style={{textAlign: 'center'}}>{currentQuestion.explanation}</p>
                    </div>
                  )}

                  {showExplanation && currentQuestion.commonMistake && (
                    <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-4">
                      <p className="font-bold text-yellow-800 mb-2">âš ï¸ × ×§×•×“×ª ×ª×©×•××ª ×œ×‘:</p>
                      <p className="text-yellow-900">{currentQuestion.commonMistake}</p>
                    </div>
                  )}

                  <div className="flex gap-4">
                    {!feedback ? (
                      <button
                        onClick={checkAnswer}
                        className="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
                      >
                        ×‘×“×•×§ ×ª×©×•×‘×”
                      </button>
                    ) : (
                      <button
                        onClick={generateNewQuestion}
                        className="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
                      >
                        ×©××œ×” ×”×‘××” â†
                      </button>
                    )}
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h3 className="font-bold text-lg mb-3 text-gray-800">ğŸ“ ×˜×™×¤×™× ×œ×ª×¨×’×•×œ:</h3>
                  <ul className="space-y-2 text-gray-700">
                    <li>â€¢ ×§×¨×/×™ ×›×œ ×©××œ×” ×‘×§×¤×™×“×” ×œ×¤× ×™ ×©×¢×•× ×™×</li>
                    <li>â€¢ <strong>5 ×ª×©×•×‘×•×ª × ×›×•× ×•×ª ×‘×¨×¦×£ = ×¢×•×œ×™× ×¨××”!</strong> ğŸ”¥</li>
                    <li>â€¢ ×× ×˜×¢×™×ª - ×§×¨×/×™ ××ª ×”×”×¡×‘×¨ ×›×“×™ ×œ×œ××•×“</li>
                    <li>â€¢ ×©×™×/×™ ×œ×‘ ×œ× ×§×•×“×•×ª ×”××¢×™×“×” ×”××¡×•×× ×•×ª âš ï¸</li>
                    <li>â€¢ × ×™×ª×Ÿ ×œ×œ×—×•×¥ Enter ×›×“×™ ×œ×©×œ×•×— ×ª×©×•×‘×” ××• ×œ×¢×‘×•×¨ ×œ×©××œ×” ×”×‘××”</li>
                    <li>â€¢ ××˜×¨×”: ×œ×”×’×™×¢ ×œ-80% ×”×¦×œ×—×” ×•××¢×œ×”!</li>
                  </ul>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<MathPracticeGame />, document.getElementById('root'));
    </script>
</body>
</html>
